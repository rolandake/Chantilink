# ===============================================
# üöÄ Nettoyage automatique des logs volumineux pour Git
# ===============================================

# Taille limite pour GitHub en bytes (100 MB)
$maxSize = 100MB

# Dossier contenant les logs
$logFolder = "backend/logs"

# V√©rifie que le dossier existe
if (!(Test-Path $logFolder)) {
    Write-Host "‚ö†Ô∏è Dossier $logFolder introuvable."
    exit
}

# Cherche tous les fichiers .log d√©passant $maxSize
$largeLogs = Get-ChildItem -Path $logFolder -Filter *.log | Where-Object { $_.Length -gt $maxSize }

if ($largeLogs.Count -eq 0) {
    Write-Host "‚úÖ Aucun fichier log volumineux trouv√©."
} else {
    Write-Host "‚ö†Ô∏è Fichiers log volumineux d√©tect√©s :"
    $largeLogs | ForEach-Object { Write-Host $_.FullName }

    # Supprimer du suivi Git
    foreach ($file in $largeLogs) {
        git rm --cached $file.FullName
        Write-Host "üìå Retir√© du suivi Git : $($file.FullName)"
    }

    # Ajouter les logs au .gitignore
    $gitignorePath = ".gitignore"
    if (!(Test-Path $gitignorePath)) {
        New-Item -ItemType File -Path $gitignorePath -Force
    }

    $ignoreLine = "$logFolder/*.log"
    if (-not (Select-String -Path $gitignorePath -Pattern [regex]::Escape($ignoreLine))) {
        Add-Content -Path $gitignorePath -Value $ignoreLine
        Write-Host "‚úÖ Ajout√© au .gitignore : $ignoreLine"
    } else {
        Write-Host "‚ÑπÔ∏è Ligne d√©j√† pr√©sente dans .gitignore"
    }

    # Commit automatique
    git add .gitignore
    git commit -m "Remove large log files and ignore logs"
    Write-Host "‚úÖ Commit cr√©√© avec succ√®s"
}

Write-Host "`nüí° Script termin√©. Tu peux maintenant faire : git push origin main"
